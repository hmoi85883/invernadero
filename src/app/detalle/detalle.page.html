<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" color="light" icon="arrow-back-outline"></ion-back-button>
    </ion-buttons>
    <ion-title style="font-size: 18px;">{{ data.invernaderoActual?.nombre }}</ion-title>
  </ion-toolbar>

  <div style="padding: 0 16px 16px;">
    <ion-segment [(ngModel)]="seccion" (ionChange)="segmentChanged($event)" mode="ios"
      style="background: #1e1e1e; border-radius: 8px; padding: 4px;">
      
      <ion-segment-button value="monitor" style="--indicator-color: #333; --color: #888; --color-checked: white;">
        <ion-label>Monitor</ion-label>
      </ion-segment-button>
      
      <ion-segment-button value="graficas" style="--indicator-color: #333; --color: #888; --color-checked: white;">
        <ion-label>Gr√°ficas</ion-label>
      </ion-segment-button>
      
    </ion-segment>
  </div>
</ion-header>

<ion-content class="ion-padding">

  <div *ngIf="data.invernaderoActual && seccion === 'monitor'">

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">

      <div *ngFor="let s of data.invernaderoActual.sensores" (click)="data.editarSensor(s)"
        class="premium-card ion-activatable ripple-parent"
        style="margin: 0; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; min-height: 140px;">
        <ion-ripple-effect></ion-ripple-effect>

        <div style="display: flex; justify-content: space-between; align-items: start;">
          <div [style.background]="'rgba(255,255,255,0.05)'" style="padding: 10px; border-radius: 10px;">
            <ion-icon [name]="data.analizarSensor(s.nombre, s.valor).icono"
              [color]="data.analizarSensor(s.nombre, s.valor).color" style="font-size: 24px;"></ion-icon>
          </div>
          <ion-icon name="create-outline" color="medium" style="font-size: 16px; opacity: 0.5;"></ion-icon>
        </div>

        <div>
          <h2 style="font-size: 26px; font-weight: 700; margin: 0; color: white;">{{ s.valor }}</h2>
          <p style="font-size: 12px; margin: 5px 0 0; text-transform: uppercase; color: #888; letter-spacing: 0.5px;">
            {{ s.nombre }}
          </p>
        </div>
      </div>

    </div>

    <div style="margin-top: 20px; text-align: center;">
      <ion-button fill="outline" color="medium" (click)="data.solicitarNuevoSensor()" 
        style="--border-radius: 20px; opacity: 0.6;">
        <ion-icon name="add" slot="start"></ion-icon>
        Agregar Sensor
      </ion-button>
    </div>

  </div>

  <div *ngIf="seccion === 'graficas'" style="height: 100%; width: 100%;">

    <div class="premium-card" style="padding: 10px; background: #1e1e1e; border: 1px solid #333; margin-bottom: 20px;">

      <h3 style="margin: 10px 0 20px 10px; color: #ddd; font-size: 16px;">
        <ion-icon name="pulse-outline"
          style="vertical-align: middle; color: var(--ion-color-primary); margin-right: 5px;"></ion-icon>
        Monitor en Tiempo Real
      </h3>

      <div style="position: relative; height: 350px; width: 100%; display: block;">
        <canvas id="lineCanvas"></canvas>
      </div>

      <p class="ion-text-center" style="color: #666; font-size: 12px; margin-top: 10px;">
        * Actualizando cada 5s
      </p>
    </div>

  </div>

</ion-content>